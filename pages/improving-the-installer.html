

<h2>Improving the installer</h2>

<?php if (showTodoMessages()): ?>
	<div class="todo">
		I think the first person voice here is okay - the tutorial starts off with it, so it's
		consistent.
	</div>
<?php endif ?>

<p>
	At this juncture, I decided to tidy up the installer a bit more. Firstly, it would be nice to
	see some data about what it has created; in the course of development you can expect
	to wipe and recreate your test data hundreds of times, so it's worth making the output
	useful.
</p>

<p>
	Secondly, as it stands it demonstrates non-optimal techniques, and fixing that gives me an
	opportunity to explain how to improve upon it. Broadly, the problem is that visiting the URL
	changes the database, but it does not take into account that web addresses can receive visits
	from automated software (e.g. search engines looking for new websites). To be sure that it
	is a human who has requested an install, I've used a form with a "post" method (this is
	explained in more detail later).
</p>

<?php if (showTodoMessages()): ?>
	<div class="todo">
		Check that the promised future note about POST actually materialises :)
	</div>
<?php endif ?>

<p>
	The changes here are quite substantial, so you may find it easier to download the file, and
	copy the whole thing over the top of the old version. So, here's the diff:
</p>

<?php renderDiff('5b249d64009b5587b88a80be393cee0342e5da5f') ?>

<p>
	Finally, let's add some links so we can easily move to our next task after re-installing:
</p>

<?php renderDiff('5b007be9914dd76d71a077a89981eeabb7458a16') ?>

<p>
	As is our custom, delete your database file and re-run the installer. This time you should
	have an "Install" button. All being well, it will do the same installation when you click it,
	and then you can opt to go straight to the blog's home page.
</p>

<div class="intermission">~</div>

<p>
	Since our changes to the installer have been brief, let's do some refactoring and a couple of
	minor functionality tweaks. Now, it could be said that this process of tidying seems rather
	erratic, and that similar items of work should be neatly collected together. However, real-life
	development rarely works that way: instead, a rough but usable solution is developed, and then
	improvements and refactorings are added depending on user feedback, and often also on time
	available.
</p>

<p>
	So, here's our first small improvement task. One of the things you may have noticed is that
	posts and comments are being marked as written on a particular day, but with no time
	information. It is usual to record and show this sort of data, so let's do that now. Don't
	forget to re-run the installer to test it!
</p>

<?php renderDiff('0d117cf12fd4ecd973101bccd3709c90d8634cda') ?>

<p>
	Following on from our last bit of refactoring, here's another opportunity to tidy code. Arguably,
	the view post page has too much business logic in it, and it would be more maintainable
	to move this to a separate file. So, create "lib/view-post.php" and paste in the new content.
</p>

<?php renderDiff('5a02c57be7b99a97ee52a147a095e5a3f8080fb7') ?>

<p>
	One of the situations we have not yet catered for is the user requesting a blog article
	that does not exist. We need to handle that based on the maxim that "if something can go
	wrong, it will". There are a good few small changes here, but in essence our approach is
	that if we cannot find a database row, we issue a browser redirect and show an error.
</p>

<?php renderDiff('6a1b41d4adea261b79f79abd26a602d57b861595') ?>

<p>
	Since the browser redirect is useful, it has been written as a function, and re-used by
	the installer. Although there is no new data to install, it is a good idea to delete your
	database file and re-install at this point, just to check it still works.
</p>

