

<h2>All posts page</h2>

<p>
	The next step is to add an All Posts screen for administrative users. We'll start with
	a static mock-up with hard-wired post values:
</p>

<?php renderDiffFromComment('Add mockup of All Posts screen for admin users') ?>

<p>
	Of course, since this is a restricted screen, we must only allow authorised users to see it.
	To do so, we redirect back to the home page, and exit as usual:
</p>

<?php renderDiffFromComment('Only allow auth users to see the All Posts screen') ?>


<p>
	Great stuff. Don't forget to test it by logging out, and then trying to visit the page
	manually!
</p>

<?php if (showTodoMessages()): ?>
	<div class="comment note">
		This sidebar section might be slightly better melded into the text, which is
		pretty light at the moment anyway.
	</div>
<?php endif ?>

<blockquote class="sidebar">
	<div class="heading">
		<p>What do square brackets in form elements do?</p>
	</div>
	<p>
		Aha! Glad you asked. First, let's consider this simple form element:
	</p>

	<blockquote class="code">
		<pre><code>&lt;input type="submit" name="save" value="Save" /&gt;</code></pre>
	</blockquote>

	<p>
		This is pretty simple. If the button is pressed, the form is submitted, and the submitted
		key <code>save</code> gets the value of the button, "Save".
	</p>

	<p>
		However, consider the scenario where we need several submit buttons carrying out a similar
		purpose, e.g. a delete button per database row. One solution is to add in the primary key
		as part of the name:
	</p>

	<blockquote class="code">
<pre><code>&lt;input type="submit" name="delete_1" value="Delete" /&gt;
&lt;input type="submit" name="delete_2" value="Delete" /&gt;
&lt;input type="submit" name="delete_3" value="Delete" /&gt;</code></pre>
	</blockquote>

	<p>
		When this form gets submitted, we can search for keys matching this naming specific pattern,
		and delete the matching row as appropriate. However, this is rather fiddly, so PHP
		provides a cleaner solution - the square bracket syntax:
	</p>

	<blockquote class="code">
<pre><code>&lt;input type="submit" name="delete[1]" value="Delete" /&gt;
&lt;input type="submit" name="delete[2]" value="Delete" /&gt;
&lt;input type="submit" name="delete[3]" value="Delete" /&gt;</code></pre>
	</blockquote>

	<p>
		This helps up cheat by doing some of our parsing for us. Here's what happens in that form
		if we press the second Delete button:
	</p>

	<blockquote class="code">
<pre><code>Array
(
    [delete] => Array
        (
            [2] => Delete
        )
)</code></pre>
	</blockquote>

	<p>
		This makes things nice and easy: we just look up the name of the element
		(i.e. <code>delete</code>), and then grab the first key value.
	</p>
</blockquote>

<p>
	Now, the logic we use to read the posts for the front page will be useful also for this
	new screen. Since we don't want to write this twice, let's move it to a function so we can
	reuse it later on.
</p>

<?php renderDiffFromComment('Move home page logic to central location, so we can reuse it for All Posts') ?>

<p>
	While working on the home page, I noticed I'd used the variable name <code>$row</code>. This
	is rather generic &mdash; most things read from a database are rows &mdash; so I swapped to
	a better name for it. This is more readable, and fits in with the common naming convention
	of using a plural name for an array and the corresponding singular name for each item.
</p>

<?php renderDiffFromComment('Improve the name of this variable') ?>

<p>
	Next, we'll modify the mock-up by adding in a creation time for posts:
</p>

<?php renderDiffFromComment('Add in creation time to All Posts') ?>

<p>
	As with our mock-up approach before, once a layout contains everything required, it is time to
	convert to a working version. So, let's do that now: we'll add a loop and render table data in
	the HTML.
</p>

<?php renderDiffFromComment('Wire in database calls for All Posts screen') ?>

<p>
	As it stands, the user may click on a delete button to remove a post, but this is not
	presently handled. So, let's do that now:
</p>

<?php renderDiffFromComment('Add delete post feature') ?>

<p>
	Finally let's add in a post count on this page:
</p>

<?php renderDiffFromComment('Add in post count on All Posts page') ?>

